#!/bin/bash

BASE_DIR=~/sparkTwitter
TWEET_DIR=$BASE_DIR/data
MODEL_DIR=$BASE_DIR/model
NUM_CLUSTERS=1
NUM_ITERATIONS=10

function help {
  echo "
Runs ExamineAndTrain from a local Spark instance.
Stores the model into $MODEL_DIR using $NUM_CLUSTERS clusters and $NUM_ITERATIONS iterations.

Before running this script, set the following environment variables to actual values:
  export SPARK_TWITTER_CONSUMER_KEY=blahblah
  export SPARK_TWITTER_CONSUMER_SECRET=blahblah
  export SPARK_TWITTER_ACCESS_TOKEN=blahblah
  export SPARK_TWITTER_ACCESS_TOKEN_SECRET=blahblah

Values for the above environment variables can be obtained from https://apps.twitter.com.
This Twitter app only needs read privileges; it does not create tweets.
"
  exit -1
}

if [ -h == "$1" ] || \
   [ -z "$SPARK_TWITTER_CONSUMER_KEY" ] || \
   [ -z "$SPARK_TWITTER_CONSUMER_SECRET" ] || \
   [ -z "$SPARK_TWITTER_ACCESS_TOKEN" ] || \
   [ -z "$SPARK_TWITTER_ACCESS_TOKEN_SECRET" ]; then help; fi

# command-line arguments: <tweetDirectory> <modelDirectory> <numClusters> <numIterations>
spark-shell --master local[*] \
  --class com.databricks.apps.twitterClassifier.ExamineAndTrain \
  --jars target/scala-2.11/spark-twitter-lang-classifier-assembly-2.0.0.jar \
  --consumerKey $SPARK_TWITTER_CONSUMER_KEY \
  --consumerSecret $SPARK_TWITTER_CONSUMER_SECRET \
  --accessToken $SPARK_TWITTER_ACCESS_TOKEN \
  --accessTokenSecret $SPARK_TWITTER_ACCESS_TOKEN_SECRET \
  --overWrite \
  $TWEET_DIR $MODEL_DIR $NUM_CLUSTERS $NUM_ITERATIONS
